<script>
(async () => {
  const statusEl = document.createElement('p');
  statusEl.textContent = 'Controller: checking...';
  document.body.appendChild(statusEl);

  try {
    const cfg = await fetch('config.json', { cache: 'no-store' })
      .then(r => r.ok ? r.json() : {});

    // Expect proxy-mode keys from config.json
    //   CONTROLLER_URL: "/api"
    //   WEBSOCKET_URL:  "/ws"  (not used here, but future-proof)
    const baseFromCfg = (cfg && typeof cfg.CONTROLLER_URL === 'string') ? cfg.CONTROLLER_URL : '/api';
    const base = baseFromCfg.replace(/\/+$/, ''); // trim trailing slash(es)
    const healthUrl = `${base}/healthz`;          // e.g., /api/healthz

    const res = await fetch(healthUrl, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const txt = await res.text();

    statusEl.textContent = `Controller: healthy (${txt})`;
    statusEl.style.color = 'green';
  } catch (e) {
    statusEl.textContent = `Controller: unreachable (${e.message})`;
    statusEl.style.color = 'crimson';
  }
})();
</script>
