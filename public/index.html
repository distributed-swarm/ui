<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Swarm UI</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; }
    .ok { color: green; }
    .bad { color: crimson; }
  </style>
</head>
<body>
  <h1>Distributed Swarm Dashboard</h1>
  <p id="status">Controller: checking...</p>

  <script>
  (async () => {
    const statusEl = document.getElementById('status');

    try {
      // Always read config.json; nginx sets it no-store so you can change targets without rebuilds
      const cfg = await fetch('config.json', { cache: 'no-store' }).then(r => r.json());

      // Proxy mode: config.json must have CONTROLLER_URL: "/api"
      const base = (cfg.CONTROLLER_URL || '/api').replace(/\/+$/, '');
      const healthUrl = `${base}/healthz`;   // => /api/healthz

      const res = await fetch(healthUrl, { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const txt = await res.text();

      statusEl.textContent = `Controller: healthy (${txt})`;
      statusEl.className = 'ok';
    } catch (e) {
      statusEl.textContent = `Controller: unreachable (${e.message})`;
      statusEl.className = 'bad';
    }
  })();
  </script>
</body>
</html>
