<script>
(async () => {
  const statusEl = document.createElement('p');
  statusEl.textContent = 'Controller: checking...';
  document.body.appendChild(statusEl);

  try {
    const cfg = await fetch('config.json', { cache: 'no-store' })
      .then(r => r.ok ? r.json() : {})
      .catch(() => ({}));

    const base = (cfg && cfg.apiBase ? cfg.apiBase : '').replace(/\/+$/,'');
    // Prefer same-origin reverse proxy; fall back to apiBase if provided
    const url = base ? `${base}/healthz` : `/controller/healthz`;

    const res = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const txt = await res.text();

    statusEl.textContent = `Controller: healthy (${txt})`;
    statusEl.style.color = 'green';
  } catch (e) {
    statusEl.textContent = `Controller: unreachable (${e.message})`;
    statusEl.style.color = 'crimson';
  }
})();
</script>
